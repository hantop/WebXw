<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap>
<typeAlias alias="LnApplyReg" type="app.creditapp.ln.entity.LnApplyReg"/>
	 <!-- 列表查询返回字段 -->
    <resultMap id="RM.LnApplyReg" class="LnApplyReg">
    <result property="batchNo" column="BATCH_NO" />
    <result property="appId" column="APP_ID" />
    <result property="appAmt" column="APP_AMT" jdbcType="double"/>
    <result property="pactAmt" column="PACT_AMT" jdbcType="double"/>
    <result property="lnRate" column="LN_RATE" jdbcType="double"/>
    <result property="overRate" column="OVER_RATE" jdbcType="double"/>
    <result property="damRate" column="DAM_RATE" jdbcType="double"/>
    <result property="appArea" column="APP_AREA" />
    <result property="lnUse" column="LN_USE" />
    <result property="repayType" column="REPAY_TYPE" />
    <result property="termMon" column="TERM_MON" jdbcType="Int"/>
    <result property="termDay" column="TERM_DAY" jdbcType="Int"/>
    <result property="vouType" column="VOU_TYPE" />
    <result property="begDate" column="BEG_DATE" />
    <result property="endDate" column="END_DATE" />
    <result property="payType" column="PAY_TYPE" />
    <result property="payKind" column="PAY_KIND" />
    <result property="payDay" column="PAY_DAY" jdbcType="Int"/>
    <result property="feeType" column="FEE_TYPE" />
    <result property="payMent" column="PAY_MENT" />
    <result property="vouDays" column="VOU_DAYS" jdbcType="Int"/>
    <result property="feeTotal" column="FEE_TOTAL" jdbcType="double"/>
    <result property="feeRate" column="FEE_RATE" jdbcType="double"/>
    <result property="feeAmt" column="FEE_AMT" jdbcType="double"/>
    <result property="srvRate" column="SRV_RATE" jdbcType="double"/>
    <result property="srvAmt" column="SRV_AMT" jdbcType="double"/>
    <result property="vouRate" column="VOU_RATE" jdbcType="double"/>
    <result property="vouAmt" column="VOU_AMT" jdbcType="double"/>
    <result property="feeAmt1" column="FEE_AMT1" jdbcType="double"/>
    <result property="feeAmt2" column="FEE_AMT2" jdbcType="double"/>
    <result property="feeAmt3" column="FEE_AMT3" jdbcType="double"/>
    <result property="feeAmt4" column="FEE_AMT4" jdbcType="double"/>
    <result property="feeAmt5" column="FEE_AMT5" jdbcType="double"/>
    <result property="ifItp" column="IF_ITP" />
    <result property="ifApp" column="IF_APP" />
    <result property="ifId" column="IF_ID" />
    <result property="ifAuth" column="IF_AUTH" />
    <result property="ifPact" column="IF_PACT" />
    <result property="ifFlag" column="IF_FLAG" />
    <result property="ifCar" column="IF_CAR" />
    <result property="ifCarcred" column="IF_CARCRED" />
    <result property="ifRoom" column="IF_ROOM" />
    <result property="ifMort" column="IF_MORT" />
    <result property="ifCard" column="IF_CARD" />
    <result property="cardAmt" column="CARD_AMT" />
    <result property="appSts" column="APP_STS" />
    <result property="splitSts" column="SPLIT_STS" />
    <result property="apprSts" column="APPR_STS" />
    <result property="brNo" column="BR_NO" />
    <result property="pactNo" column="PACT_NO" />
    <result property="appDate" column="APP_DATE" />
    <result property="pactXt" column="PACT_XT" />
    <result property="brAccType" column="BR_ACC_TYPE" />
    <result property="cifName" column="CIF_NAME" />
    <result property="idType" column="ID_TYPE" />
    <result property="idNo" column="ID_NO" />
    <result property="cifType" column="CIF_TYPE" />
    <result property="sex" column="SEX" />
    <result property="birthDay" column="BIRTH_DAY" />
    <result property="marriage" column="MARRIAGE" />
    <result property="children" column="CHILDREN" />
    <result property="edu" column="EDU" />
    <result property="degree" column="DEGREE" />
    <result property="income" column="INCOME" jdbcType="double"/>
    <result property="commTel" column="COMM_TEL" />
    <result property="phoneNo" column="PHONE_NO" />
    <result property="commCode" column="COMM_CODE" />
    <result property="commAddr" column="COMM_ADDR" />
    <result property="cifArea" column="CIF_AREA" />
    <result property="resTel" column="RES_TEL" />
    <result property="resCode" column="RES_CODE" />
    <result property="resAddr" column="RES_ADDR" />
    <result property="resSts" column="RES_STS" />
    <result property="workType" column="WORK_TYPE" />
    <result property="corpName" column="CORP_NAME" />
    <result property="corpWay" column="CORP_WAY" />
    <result property="corpCode" column="CORP_CODE" />
    <result property="corpAddr" column="CORP_ADDR" />
    <result property="duty" column="DUTY" />
    <result property="title" column="TITLE" />
    <result property="workYear" column="WORK_YEAR" />
    <result property="mateName" column="MATE_NAME" />
    <result property="mateIdtype" column="MATE_IDTYPE" />
    <result property="mateIdno" column="MATE_IDNO" />
    <result property="mateWork" column="MATE_WORK" />
    <result property="mateTel" column="MATE_TEL" />
    <result property="projNo" column="PROJ_NO" />
    <result property="prdtNo" column="PRDT_NO" />
    <result property="lnType" column="LN_TYPE" />
    <result property="curNo" column="CUR_NO" />
    <result property="prdtName" column="PRDT_NAME" />
    <result property="czPactNo" column="CZ_PACT_NO" />
    <result property="workSts" column="WORK_STS" />
    <result property="txdate" column="TX_DATE" />
    </resultMap>
     <sql id="LnApplyReg.columns">
        <![CDATA[
         BATCH_NO,
         APP_ID,
         APP_AMT,
         PACT_AMT,
         LN_RATE,
         OVER_RATE,
         DAM_RATE,
         APP_AREA,
         LN_USE,
         REPAY_TYPE,
         TERM_MON,
         TERM_DAY,
         VOU_TYPE,
         BEG_DATE,
         END_DATE,
         PAY_TYPE,
         PAY_KIND,
         PAY_DAY,
         FEE_TYPE,
         PAY_MENT,
         VOU_DAYS,
         FEE_TOTAL,
         FEE_RATE,
         FEE_AMT,
         SRV_RATE,
         SRV_AMT,
         VOU_RATE,
         VOU_AMT,
         FEE_AMT1,
         FEE_AMT2,
         FEE_AMT3,
         FEE_AMT4,
         FEE_AMT5,
         IF_ITP,
         IF_APP,
         IF_ID,
         IF_AUTH,
         IF_PACT,
         IF_FLAG,
         IF_CAR,
         IF_CARCRED,
         IF_ROOM,
         IF_MORT,
         IF_CARD,
         CARD_AMT,
         APP_STS,
         SPLIT_STS,
         APPR_STS,
         BR_NO,
         PACT_NO,
         APP_DATE,
         PACT_XT,
         BR_ACC_TYPE,
         CIF_NAME,
         ID_TYPE,
         ID_NO,
         CIF_TYPE,
         SEX,
         BIRTH_DAY,
         MARRIAGE,
         CHILDREN,
         EDU,
         DEGREE,
         INCOME,
         COMM_TEL,
         PHONE_NO,
         COMM_CODE,
         COMM_ADDR,
         CIF_AREA,
         RES_TEL,
         RES_CODE,
         RES_ADDR,
         RES_STS,
         WORK_TYPE,
         CORP_NAME,
         CORP_WAY,
         CORP_CODE,
         CORP_ADDR,
         DUTY,
         TITLE,
         WORK_YEAR,
         MATE_NAME,
         MATE_IDTYPE,
         MATE_IDNO,
         MATE_WORK,
         MATE_TEL,
         PROJ_NO,
         PRDT_NO,
         LN_TYPE,
         CUR_NO,
         fun_getprdtname(prdt_no) as PRDT_NAME,
         CZ_PACT_NO,
         WORK_STS,
         TX_DATE
          ]]>
    </sql>
    <!-- 表新增 -->
    <insert id="LnApplyReg.insert">
        <![CDATA[
        INSERT INTO LN_APPLY_REG(
         BATCH_NO,
         APP_ID,
         APP_AMT,
         PACT_AMT,
         LN_RATE,
         OVER_RATE,
         DAM_RATE,
         APP_AREA,
         LN_USE,
         REPAY_TYPE,
         TERM_MON,
         TERM_DAY,
         VOU_TYPE,
         BEG_DATE,
         END_DATE,
         PAY_TYPE,
         PAY_KIND,
         PAY_DAY,
         FEE_TYPE,
         PAY_MENT,
         VOU_DAYS,
         FEE_TOTAL,
         FEE_RATE,
         FEE_AMT,
         SRV_RATE,
         SRV_AMT,
         VOU_RATE,
         VOU_AMT,
         FEE_AMT1,
         FEE_AMT2,
         FEE_AMT3,
         FEE_AMT4,
         FEE_AMT5,
         IF_ITP,
         IF_APP,
         IF_ID,
         IF_AUTH,
         IF_PACT,
         IF_FLAG,
         IF_CAR,
         IF_CARCRED,
         IF_ROOM,
         IF_MORT,
         IF_CARD,
         CARD_AMT,
         APP_STS,
         SPLIT_STS,
         APPR_STS,
         BR_NO,
         PACT_NO,
         APP_DATE,
         PACT_XT,
         BR_ACC_TYPE,
         CIF_NAME,
         ID_TYPE,
         ID_NO,
         CIF_TYPE,
         SEX,
         BIRTH_DAY,
         MARRIAGE,
         CHILDREN,
         EDU,
         DEGREE,
         INCOME,
         COMM_TEL,
         PHONE_NO,
         COMM_CODE,
         COMM_ADDR,
         CIF_AREA,
         RES_TEL,
         RES_CODE,
         RES_ADDR,
         RES_STS,
         WORK_TYPE,
         CORP_NAME,
         CORP_WAY,
         CORP_CODE,
         CORP_ADDR,
         DUTY,
         TITLE,
         WORK_YEAR,
         MATE_NAME,
         MATE_IDTYPE,
         MATE_IDNO,
         MATE_WORK,
         MATE_TEL,
         PROJ_NO,
         PRDT_NO,
         LN_TYPE,
         CUR_NO,
         CZ_PACT_NO,
         WORK_STS,
         TX_DATE
         )VALUES(
         #batchNo#,
         #appId#,
         #appAmt#,
         #pactAmt#,
         #lnRate#,
         #overRate#,
         #damRate#,
         #appArea#,
         #lnUse#,
         #repayType#,
         #termMon#,
         #termDay#,
         #vouType#,
         #begDate#,
         #endDate#,
         #payType#,
         #payKind#,
         #payDay#,
         #feeType#,
         #payMent#,
         #vouDays#,
         #feeTotal#,
         #feeRate#,
         #feeAmt#,
         #srvRate#,
         #srvAmt#,
         #vouRate#,
         #vouAmt#,
         #feeAmt1#,
         #feeAmt2#,
         #feeAmt3#,
         #feeAmt4#,
         #feeAmt5#,
         #ifItp#,
         #ifApp#,
         #ifId#,
         #ifAuth#,
         #ifPact#,
         #ifFlag#,
         #ifCar#,
         #ifCarcred#,
         #ifRoom#,
         #ifMort#,
         #ifCard#,
         #cardAmt#,
         #appSts#,
         #splitSts#,
         #apprSts#,
         #brNo#,
         #pactNo#,
         #appDate#,
         #pactXt#,
         #brAccType#,
         #cifName#,
         #idType#,
         #idNo#,
         #cifType#,
         #sex#,
         #birthDay#,
         #marriage#,
         #children#,
         #edu#,
         #degree#,
         #income#,
         #commTel#,
         #phoneNo#,
         #commCode#,
         #commAddr#,
         #cifArea#,
         #resTel#,
         #resCode#,
         #resAddr#,
         #resSts#,
         #workType#,
         #corpName#,
         #corpWay#,
         #corpCode#,
         #corpAddr#,
         #duty#,
         #title#,
         #workYear#,
         #mateName#,
         #mateIdtype#,
         #mateIdno#,
         #mateWork#,
         #mateTel#,
         #projNo#,
         #prdtNo#,
         #lnType#,
         #curNo#,
         #czPactNo#,
         #workSts#,
         #txdate#
         )
          ]]>
    </insert>
    <!-- 表删除 -->
    <delete id="LnApplyReg.del">
        <![CDATA[
               DELETE FROM LN_APPLY_REG
                 WHERE
               	APP_ID = #appId#        ]]>
    </delete>
    <!-- 表修改 -->
    <update id="LnApplyReg.update">
        <![CDATA[
         UPDATE LN_APPLY_REG set
         BATCH_NO=#batchNo#,
         APP_ID=#appId#,
         APP_AMT=#appAmt#,
         PACT_AMT=#pactAmt#,
         LN_RATE=#lnRate#,
         OVER_RATE=#overRate#,
         DAM_RATE=#damRate#,
         APP_AREA=#appArea#,
         LN_USE=#lnUse#,
         REPAY_TYPE=#repayType#,
         TERM_MON=#termMon#,
         TERM_DAY=#termDay#,
         VOU_TYPE=#vouType#,
         BEG_DATE=#begDate#,
         END_DATE=#endDate#,
         PAY_TYPE=#payType#,
         PAY_KIND=#payKind#,
         PAY_DAY=#payDay#,
         FEE_TYPE=#feeType#,
         PAY_MENT=#payMent#,
         VOU_DAYS=#vouDays#,
         FEE_TOTAL=#feeTotal#,
         FEE_RATE=#feeRate#,
         FEE_AMT=#feeAmt#,
         SRV_RATE=#srvRate#,
         SRV_AMT=#srvAmt#,
         VOU_RATE=#vouRate#,
         VOU_AMT=#vouAmt#,
         FEE_AMT1=#feeAmt1#,
         FEE_AMT2=#feeAmt2#,
         FEE_AMT3=#feeAmt3#,
         FEE_AMT4=#feeAmt4#,
         FEE_AMT5=#feeAmt5#,
         IF_ITP=#ifItp#,
         IF_APP=#ifApp#,
         IF_ID=#ifId#,
         IF_AUTH=#ifAuth#,
         IF_PACT=#ifPact#,
         IF_FLAG=#ifFlag#,
         IF_CAR=#ifCar#,
         IF_CARCRED=#ifCarcred#,
         IF_ROOM=#ifRoom#,
         IF_MORT=#ifMort#,
         IF_CARD=#ifCard#,
         CARD_AMT=#cardAmt#,
         APP_STS=#appSts#,
         SPLIT_STS=#splitSts#,
         APPR_STS=#apprSts#,
         BR_NO=#brNo#,
         PACT_NO=#pactNo#,
         APP_DATE=#appDate#,
         PACT_XT=#pactXt#,
         BR_ACC_TYPE=#brAccType#,
         CIF_NAME=#cifName#,
         ID_TYPE=#idType#,
         ID_NO=#idNo#,
         CIF_TYPE=#cifType#,
         SEX=#sex#,
         BIRTH_DAY=#birthDay#,
         MARRIAGE=#marriage#,
         CHILDREN=#children#,
         EDU=#edu#,
         DEGREE=#degree#,
         INCOME=#income#,
         COMM_TEL=#commTel#,
         PHONE_NO=#phoneNo#,
         COMM_CODE=#commCode#,
         COMM_ADDR=#commAddr#,
         CIF_AREA=#cifArea#,
         RES_TEL=#resTel#,
         RES_CODE=#resCode#,
         RES_ADDR=#resAddr#,
         RES_STS=#resSts#,
         WORK_TYPE=#workType#,
         CORP_NAME=#corpName#,
         CORP_WAY=#corpWay#,
         CORP_CODE=#corpCode#,
         CORP_ADDR=#corpAddr#,
         DUTY=#duty#,
         TITLE=#title#,
         WORK_YEAR=#workYear#,
         MATE_NAME=#mateName#,
         MATE_IDTYPE=#mateIdtype#,
         MATE_IDNO=#mateIdno#,
         MATE_WORK=#mateWork#,
         MATE_TEL=#mateTel#,
         PROJ_NO=#projNo#,
         PRDT_NO=#prdtNo#,
         LN_TYPE=#lnType#,
         CUR_NO=#curNo#,
         CZ_PACT_NO=#czPactNo#,
         WORK_STS=#workSts#,
         TX_DATE=#txdate#
          WHERE
               	APP_ID = #appId#        ]]>
    </update>
    
        <update id="LnApplyReg.updateBypactNo">
        <![CDATA[
         UPDATE LN_APPLY_REG set
         CIF_NAME=#cifName#,
         PHONE_NO =#phoneNo#
          WHERE
               	PACT_NO=#pactNo#       ]]>
    </update>
    
    <update id="LnApplyReg.resultIdUpdate">
        <![CDATA[
         UPDATE LN_APPLY_REG set
         APPR_STS=#apprSts#
          WHERE
               	APP_ID = #appId#  		]]>
    </update>
     <!-- 表查询ById -->
    <select id="LnApplyReg.getById"  resultMap="RM.LnApplyReg">
        SELECT <include refid="LnApplyReg.columns"/>
        <![CDATA[
             FROM LN_APPLY_REG 
         WHERE 
               	APP_ID = #appId#        ]]>
     </select>
<select id="LnApplyReg.getBypactNo"  resultMap="RM.LnApplyReg">
      SELECT <include refid="LnApplyReg.columns"/>
        <![CDATA[
             FROM LN_APPLY_REG 
         WHERE 
               	PACT_NO = #pactNo#        ]]>
     </select>
     <!--接口5101 账户开户 使用查询条件-->
    <sql id="LnApplyReg.findPage.whereFor5101">
        <dynamic prepend="where">
        	<isPropertyAvailable property="idNo">
                  <isNotEmpty prepend="AND" property="idNo">
                      ID_NO = #idNo#
                   </isNotEmpty>
             </isPropertyAvailable>
        	<isPropertyAvailable property="brNo">
                  <isNotEmpty prepend="AND" property="brNo">
                      BR_NO = #brNo#
                   </isNotEmpty>
             </isPropertyAvailable>
        	<isPropertyAvailable property="cifName">
                  <isNotEmpty prepend="AND" property="cifName">
                      CIF_NAME = #cifName#
                   </isNotEmpty>
             </isPropertyAvailable>
             <isPropertyAvailable property="pactNo">
                  <isNotEmpty prepend="AND" property="pactNo">
                      PACT_NO = #pactNo#
                   </isNotEmpty>
             </isPropertyAvailable>
        </dynamic>
    </sql>
    <!-- 接口5101 依据条件查询sql -->
    <select id="LnApplyReg.findPageFor5101"  resultMap="RM.LnApplyReg">
        SELECT <include refid="LnApplyReg.columns"/> FROM LN_APPLY_REG <include refid="LnApplyReg.findPage.whereFor5101"/> AND  APP_ID IN (SELECT APP_ID  FROM  LN_STAGE WHERE  PAY_STS='02' )      
    </select>
    <!-- 结束 -->
       <!-- 根据实际情况选择分页查询条件 -->
    <sql id="LnApplyReg.findPage.where">
        <dynamic prepend="where">
        	<isPropertyAvailable property="batchNo">
                  <isNotEmpty prepend="AND" property="batchNo">
                      BATCH_NO = #batchNo#
                   </isNotEmpty>
             </isPropertyAvailable>
        	<isPropertyAvailable property="appSts">
                  <isNotEmpty prepend="AND" property="appSts">
                      APP_STS = #appSts#
                   </isNotEmpty>
             </isPropertyAvailable>
        	<isPropertyAvailable property="cifName">
                  <isNotEmpty prepend="AND" property="cifName">
                      CIF_NAME = #cifName#
                   </isNotEmpty>
             </isPropertyAvailable>
             <isPropertyAvailable property="pactNo">
                  <isNotEmpty prepend="AND" property="pactNo">
                      PACT_NO = #pactNo#
                   </isNotEmpty>
             </isPropertyAvailable>
              <isPropertyAvailable property="loginid">
                  <isNotEmpty prepend="AND" property="loginid">
                      PACT_NO in (select PACT_NO from ln_pact where proj_no in (select proj_no from proj_mang where login_id = #loginid#))
                   </isNotEmpty>
             </isPropertyAvailable>
        </dynamic>
    </sql>
    <!-- 分页查询记录数 -->
    <select id="LnApplyReg.findPage.count" resultClass="int">
        SELECT count(*) FROM LN_APPLY_REG <include refid="LnApplyReg.findPage.where"/>
    </select>
    <!-- 分页查询 -->
    <select id="LnApplyReg.findByPage" resultMap="RM.LnApplyReg">
        SELECT <include refid="LnApplyReg.columns"/>
        FROM (
            SELECT m.*, rownum as rnum 
        FROM  
            (SELECT  BATCH_NO,
			         APP_ID,
			         APP_AMT,
			         PACT_AMT,
			         LN_RATE,
			         OVER_RATE,
			         DAM_RATE,
			         APP_AREA,
			         LN_USE,
			         REPAY_TYPE,
			         TERM_MON,
			         TERM_DAY,
			         VOU_TYPE,
			         BEG_DATE,
			         END_DATE,
			         PAY_TYPE,
			         PAY_KIND,
			         PAY_DAY,
			         FEE_TYPE,
			         PAY_MENT,
			         VOU_DAYS,
			         FEE_TOTAL,
			         FEE_RATE,
			         FEE_AMT,
			         SRV_RATE,
			         SRV_AMT,
			         VOU_RATE,
			         VOU_AMT,
			         FEE_AMT1,
			         FEE_AMT2,
			         FEE_AMT3,
			         FEE_AMT4,
			         FEE_AMT5,
			         IF_ITP,
			         IF_APP,
			         IF_ID,
			         IF_AUTH,
			         IF_PACT,
			         IF_FLAG,
			         IF_CAR,
			         IF_CARCRED,
			         IF_ROOM,
			         IF_MORT,
			         IF_CARD,
			         CARD_AMT,
			         APP_STS,
			         SPLIT_STS,
			         APPR_STS,
			         BR_NO,
			         PACT_NO,
			         APP_DATE,
			         PACT_XT,
			         BR_ACC_TYPE,
			         CIF_NAME,
			         ID_TYPE,
			         ID_NO,
			         CIF_TYPE,
			         SEX,
			         BIRTH_DAY,
			         MARRIAGE,
			         CHILDREN,
			         EDU,
			         DEGREE,
			         INCOME,
			         COMM_TEL,
			         PHONE_NO,
			         COMM_CODE,
			         COMM_ADDR,
			         CIF_AREA,
			         RES_TEL,
			         RES_CODE,
			         RES_ADDR,
			         RES_STS,
			         WORK_TYPE,
			         CORP_NAME,
			         CORP_WAY,
			         CORP_CODE,
			         CORP_ADDR,
			         DUTY,
			         TITLE,
			         WORK_YEAR,
			         MATE_NAME,
			         MATE_IDTYPE,
			         MATE_IDNO,
			         MATE_WORK,
			         MATE_TEL,
			         PROJ_NO,
			         PRDT_NO,
			         LN_TYPE,
			         CUR_NO,
			         CZ_PACT_NO,
			         WORK_STS,
			         TX_DATE
		 FROM LN_APPLY_REG
                    <include refid="LnApplyReg.findPage.where"/>
             ) m
        	) WHERE rnum &gt;= #startNum# AND rnum &lt;#endNum# 
    </select>
    <!-- 获取KEY -->
    <select id="LnApplyReg.getKey" resultClass="string">
   	 <![CDATA[ SELECT PRE_APPLY_SEQ.NEXTVAL FROM DUAL ]]>
	</select>
	
	  <select id="LnApplyReg.getByNo"  resultClass="String">
  select TO_CHAR(to_date((select SYS_DATE from sys_global), 'yyyymmdd') -
       to_date(substr(TX_DATE, 0, 8), 'yyyymmdd')) as TX_DATE
  from ln_apply_reg
  WHERE BR_NO = #brNo#  and  PACT_NO = #pactNo#
     </select>
</sqlMap>